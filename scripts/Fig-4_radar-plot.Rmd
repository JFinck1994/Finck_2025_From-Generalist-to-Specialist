---
title: "Fig. 4: Network attributtes of the microbial communities along the plant diversity gradient."
author: "Jessica Finck"
date: "2025-05-12"
output:
  pdf_document: default
  html_document: default
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
set.seed(123)
```

## Pre-requisites

### Load packages

```{r packages, message=FALSE, warning=FALSE}
library(tidyverse) # data wrangling
library(dplyr)     # data wrangling
library(ggvanced)  # plotting
library(viridis)   # plotting: color scale

set.seed(123) 
```

## Using a radar plot to visualize gradual changes

Indifferent to scatter plots which can be used to visualize and statistically test changes, i.e. over time or another variable, radar plots allow a clear visualization of changes even for single observations. Hence, why we used this form of plotting to visualize the changes in network attributes along the plant diversity gradient.

### 1. Load data

Data can be imported either directly from a file, or via a custom tibble.

```{r data_load, message=FALSE, warning=FALSE}
df <- tibble(
  PSR = as.character(c("PSR 1", "PSR 2", "PSR 4", "PSR 8", "PSR 16")),
  Nodes = c(782, 925, 880, 826, 887),
  Clustering = c(0.371, 0.385, 0.418, 0.379, 0.402),
  Degree = c(4.999, 5.405, 5.944, 4.600, 6.243),
  Connectivity = c(7.509, 8.145, 8.964, 6.985, 9.378),
  PositiveEdges = c(1638, 2292, 2400, 1633, 2525),
  NegativeEdges = c(1298, 1475, 1544, 1252, 1634))
```

### 2. Introduce dummy data to manually adjust radar plot axes scaling

Since the radar plot is plotted based on the maximum and minimum values of the underlying dataset, we created a dummy dataset, and merged it with our real data. This way, we can directly manipulate and set the desired axis scales.

```{r data_dummy, message=FALSE, warning=FALSE, tidy=F}
## introduce dummy data: axes maxima
df_dummy_max <- tibble(
  PSR = "dummy_max",
  Nodes = 1000,
  PositiveEdges = 2600,
  NegativeEdges = 1800,
  Clustering = 0.45, 
  Degree = 6.5,
  Connectivity = 9.5)

## introduce dummy data: axes minima
df_dummy_min <- tibble(
  PSR = "dummy_min",
  Nodes = 700,
  PositiveEdges = 1200,
  NegativeEdges = 1200,
  Clustering = 0.35, 
  Degree = 4.9,
  Connectivity = 6.9)

## bind real and dummy data 
df_final <- bind_rows(df, df_dummy_min, df_dummy_max)
df_final$PSR <- factor(df_final$PSR, 
                       levels = c("PSR 1", "PSR 2", "PSR 4", "PSR 8", "PSR 16",
                                  "dummy_min","dummy_max"))
```

### 3. Plot radar plot

Plotting is performed with the `ggvanced` package, and it's `ggspider` function. This function allows the exclusion of the dummy data's factor level (here: PSR) in the legend, while retaining the introduced axis scaling. However, the plot will still show the maximum and minimum as grey dots/lines within the plot. We exported the graph as SVG and manually removed the dummy data-rings in Inkscape.

```{r radarplot, tidy=FALSE, message=FALSE, warning=FALSE}
ggspider(df_final) + 
  scale_fill_viridis_d(option = "D", begin = 0, end = 1) +
  scale_color_viridis_d(option = "D", begin = 0, end = 1) +
  scale_fill_manual(values = c(viridis::viridis(5, option = "D"), NA, NA), 
                    breaks = c("PSR 1", "PSR 2", "PSR 4", "PSR 8", "PSR 16")) +
  scale_color_manual(values = c(viridis::viridis(5, option = "D"), NA, NA), 
                     breaks = c("PSR 1", "PSR 2", "PSR 4", "PSR 8", "PSR 16"))
```
